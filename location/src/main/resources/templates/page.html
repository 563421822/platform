<!DOCTYPE html><html lang="en"xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"name="viewport"content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/><title>搭讪打卡</title><style>#down{font:normal bold 1.2em/1.4em Arial,sans-serif;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:300px;height:300px;background-color:aqua;border-radius:50%;text-align:center;line-height:300px}</style><link rel="stylesheet"th:href="@{/bootstrap/css/bootstrap.min.css}"></head><body><div id="down"data-toggle="modal"data-target="#myModal">请等待</div><script>let count=0;const downObj=document.getElementById("down");const operate=setInterval(function(){downObj.innerText=String(count);count++},1000);</script><script type="text/javascript"src="http://webapi.amap.com/maps?v=1.4.3&key=385f63ab408c1c638e6bcbf1065eecd5"></script><script th:inline="javascript">const mapObj=new AMap.Map('iCenter');mapObj.plugin('AMap.Geolocation',function(){let geolocation=new AMap.Geolocation({enableHighAccuracy:true,timeout:10000,maximumAge:0,convert:true,showButton:true,buttonPosition:'LB',buttonOffset:new AMap.Pixel(10,20),showMarker:true,showCircle:true,panToLocation:true,zoomToAccuracy:true});mapObj.addControl(geolocation);geolocation.getCurrentPosition();AMap.event.addListener(geolocation,'complete',onComplete);AMap.event.addListener(geolocation,'error',onError)});let ajaxObject;if(window.XMLHttpRequest)ajaxObject=new XMLHttpRequest();else ajaxObject=new ActiveXObject("Microsoft.XMLHTTP");function onComplete(obj){ajaxObject.open("post","/location/checkLoc?logId="+[[${logId}]],true);ajaxObject.setRequestHeader("Content-type","application/json");ajaxObject.send(JSON.stringify(obj));ajaxObject.onreadystatechange=function(){clearInterval(operate);const o=JSON.parse(ajaxObject.responseText);const value=obj.formattedAddress!==undefined?obj.formattedAddress:obj.lat+","+obj.lng;if(ajaxObject.readyState===4&&ajaxObject.status===200){document.getElementById("myModal").innerHTML="<div class='modal-dialog'><div class='modal-content'><div class='modal-header'><h4 class='modal-title'id='myModalLabel'>开始打卡</h4><button type='button'class='close'data-dismiss='modal'aria-hidden='true'>&times;</button></div><form method='post'action='/location/clockIn'enctype='multipart/form-data'><input type='hidden'name='locId'id='locId'/><div class='modal-body'><div class='form-group'><label for='loc'>当前位置</label><input readonly class='form-control'id='loc'aria-describedby='help'><small id='help'class='form-text text-muted'>迈向人生巅峰的第一步</small></div><div class='form-group'><label for='status'>搭讪结果</label><select name='status'class='form-control'id='status'><option value='0'>成功</option><option value='-1'>失败</option></select></div><div class='form-group row'><label for='file'class='col-sm-2 col-form-label'>拍照</label><div class='col-sm-10'><input name='file'type='file'class='form-control'id='file'accept='image/gif,image/jpeg,image/jpg,image/png' required></div></div></div><div class='modal-footer'><button type='button'class='btn'data-dismiss='modal'>关闭</button><button type='submit'class='btn btn-primary'>立即打卡</button></div></form></div></div>";document.getElementById("loc").value=value;downObj.innerHTML=o.data.name+"<br/>距离您的位置: "+o.data.distance.toFixed(2)+"km";document.getElementById("locId").value=o.data.locId}else downObj.innerHTML="内部服务器异常:<br/><p style='line-height: 2'>"+o.msg+"<br/><small>"+value+"</small></p>"}}function onError(obj){navigator.geolocation.getCurrentPosition(function(position){const param={};const coords=position.coords;param.lng=coords.longitude;param.lat=coords.latitude;param.accuracy=coords.accuracy;onComplete(param)},function(error){const errorTypes={1:'未授予位置权限',2:'获取不到位置信息',3:'获取信息超时'};downObj.innerText=(errorTypes[error.code]);ajaxObject.open("post","location/errEmail",true);ajaxObject.setRequestHeader("Content-type","application/json");obj.logId=[[${logId}]];ajaxObject.send(JSON.stringify(obj));clearInterval(operate)})}</script><script th:src="@{/bootstrap/js/jquery.min.js}"></script><script th:src="@{/bootstrap/js/bootstrap.min.js}"></script><div class="modal fade"id="myModal"tabindex="-1"role="dialog"aria-labelledby="myModalLabel"aria-hidden="true"></div></body></html>